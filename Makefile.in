# Makefile.in -- input for rep-gtk Makefile
# Copyright (C) 1998 John Harper <john@dcs.warwick.ac.uk>
# $Id$

DEFS = gdk-1.2.defs gtk-1.2.defs
RDEFS= $(DEFS:.defs=.defs.jl)

SRCS = rep-gtk.c gtk-support.c gtk-compat.c gdk-glue.c gtk-glue.c
OBJS = $(SRCS:.c=.lo)

GLADE_SRCS = libglade-support.c libglade-glue.c
GLADE_OBJS = $(GLADE_SRCS:.c=.lo)

OUT = @OUT@

version=@version@
host_type=@host@
SHELL=/bin/sh

repexecdir=@REP_EXECDIR@
include $(repexecdir)/rules.mk

CC=@CC@
CPPFLAGS=@CPPFLAGS@
CFLAGS=@CFLAGS@
LDFLAGS=@LDFLAGS@
override CPPFLAGS += -DHAVE_CONFIG_H -I.
override CFLAGS += @GTK_CFLAGS@ @REP_CFLAGS@ @LIBGLADE_CFLAGS@
REP_GTK_LIBS=@GTK_LIBS@ @REP_LIBS@ @LIBS@
REP_GLADE_LIBS=@LIBGLADE_LIBS@ @REP_LIBS@ @LIBS@

INSTALL=@INSTALL@
INSTALL_DATA=@INSTALL_DATA@
INSTALL_PROGRAM=@INSTALL_PROGRAM@

DESTDIR=
installdir=$(repexecdir)

top_srcdir=@top_srcdir@
top_builddir=.
VPATH=@top_srcdir@:.

.PHONY: clean realclean install

all : $(OUT)

gtk.la : $(OBJS)
	$(rep_DL_LD) $(CPPFLAGS) $(CFLAGS) -o $@ $^ $(LDFLAGS) $(REP_GTK_LIBS)

libglade.la : $(GLADE_OBJS)
	$(rep_DL_LD) $(CPPFLAGS) $(CFLAGS) -o $@ $^ $(LDFLAGS) $(REP_GLADE_LIBS)

%-glue.c : %-1.2.defs.jl $(RDEFS) build-gtk.jlc
	rep --batch -l build-gtk -f build-gtk-batch $< $@

%-glue.c : %.defs.jl $(RDEFS) build-gtk.jlc
	rep --batch -l build-gtk -f build-gtk-batch $< $@

%.defs.jl : %.defs
	sed -f sed-fix-defs $< >$@

build-gtk.jlc : build-gtk.jl
	rep --batch -l compiler -f compile-batch $<

install : all installdirs
	set -e; for f in $(OUT); do \
	  $(rep_DL_INSTALL) $$f $(DESTDIR)$(installdir); \
	done
	printf "\nrep_open_globally=yes\n" >>$(DESTDIR)$(installdir)/gtk.la
	printf "\nrep_requires='gtk'\n" >>$(DESTDIR)$(installdir)/libglade.la

installdirs : $(top_srcdir)/mkinstalldirs
	$(SHELL) $(top_srcdir)/mkinstalldirs $(DESTDIR)$(installdir)

uninstall :
	$(rep_DL_UNINSTALL) $(DESTDIR)$(installdir)/$(OUT)

clean :
	rm -f *.defs.jl *-glue.c *~ core *.jlc *.o *.lo *.la
	rm -rf .libs

realclean : clean
	rm -f Makefile config.cache config.log config.status config.h
	rm -f rep-gtk.spec

cvsclean : realclean
	rm -f aclocal.m4 configure
